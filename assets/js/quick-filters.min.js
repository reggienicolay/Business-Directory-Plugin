!function(t){"use strict";const e={state:{category:null,area:null,tags:[],priceLevel:[],minRating:null,openNow:!1,search:"",sort:"featured",view:"list",page:1,lat:null,lng:null},data:{},searchTimer:null,tagFilterRequest:null,map:null,markers:[],markerCluster:null,readUrlParams:function(){const e=new URLSearchParams(window.location.search);if(e.has("category")){const s=e.get("category");let a=t(".bd-qf-experience-btn").filter(function(){return t(this).data("category-slug")===s});a.length||(a=t(".bd-qf-experience-btn").filter(function(){return String(t(this).data("category-id"))===s})),a.length&&(this.state.category=a.data("category-id"),a.addClass("active"))}if(e.has("area")){const s=e.get("area");let a=t("#bd-qf-area option").filter(function(){return t(this).data("slug")===s});a.length||(a=t('#bd-qf-area option[value="'+s+'"]')),a.length&&a.val()&&(this.state.area=parseInt(a.val(),10),t("#bd-qf-area").val(a.val()))}if(e.has("tags")){const s=e.get("tags").split(","),a=this;s.forEach(function(e){let s=t(".bd-qf-tag-btn").filter(function(){return t(this).data("tag-slug")===e});if(s.length||(s=t(".bd-qf-tag-btn").filter(function(){return String(t(this).data("tag-id"))===e})),s.length){const t=s.data("tag-id");a.state.tags.push(t),s.addClass("active")}else if(a.data&&a.data.tags){const s=a.data.tags.find(function(t){return t.slug===e||String(t.id)===e});if(s){a.state.tags.push(s.id);var i=t('.bd-qf-tag-btn[data-tag-id="'+s.id+'"]');i.length&&i.addClass("active")}}})}(e.has("search")||e.has("q"))&&(this.state.search=e.get("search")||e.get("q"),t("#bd-qf-search").val(this.state.search)),e.has("sort")&&(this.state.sort=e.get("sort"),t("#bd-qf-sort").val(this.state.sort))},updateUrl:function(){const e=new URLSearchParams;if(this.state.category){const s=t(".bd-qf-experience-btn.active");if(s.length){const t=s.data("category-slug");e.set("category",t||this.state.category)}}if(this.state.area){const s=t("#bd-qf-area option:selected");if(s.length){const t=s.data("slug");e.set("area",t||this.state.area)}}if(this.state.tags.length>0){const s=[];this.state.tags.forEach(function(e){const a=t('.bd-qf-tag-btn[data-tag-id="'+e+'"]');if(a.length){const t=a.data("tag-slug");s.push(t||e)}}),s.length>0&&e.set("tags",s.join(","))}this.state.search&&e.set("search",this.state.search),this.state.sort&&"featured"!==this.state.sort&&e.set("sort",this.state.sort);const s=e.toString()?window.location.pathname+"?"+e.toString():window.location.pathname;window.history.replaceState({},"",s)},init:function(){const e=t("#bd-qf-data");if(e.length)try{this.data=JSON.parse(e.text())}catch(t){console.error("Failed to parse Quick Filter data:",t)}this.readUrlParams(),this.state.category&&this.filterTagsForCategory(this.state.category),this.bindEvents(),this.initMap(),this.loadBusinesses(),this.updateActiveFilters()},bindEvents:function(){const e=this;t(document).on("click",".bd-qf-experience-btn",function(){const s=t(this),a=s.data("category-id");s.hasClass("active")?(s.removeClass("active"),e.state.category=null,e.showAllTags()):(t(".bd-qf-experience-btn").removeClass("active"),s.addClass("active"),e.state.category=a,e.filterTagsForCategory(a)),e.state.page=1,e.loadBusinesses(),e.updateActiveFilters()}),t(document).on("click",".bd-qf-tag-btn",function(){const s=t(this),a=s.data("tag-id");s.hasClass("active")?(s.removeClass("active"),e.state.tags=e.state.tags.filter(function(t){return t!==a})):(s.addClass("active"),e.state.tags.push(a)),e.state.page=1,e.loadBusinesses(),e.updateActiveFilters()}),t("#bd-qf-experiences-expand").on("click",function(){const e=t(this).closest(".bd-qf-experiences");e.toggleClass("expanded");const s=e.hasClass("expanded");t(this).html(s?'Show Less <i class="fas fa-chevron-up"></i>':'See All <i class="fas fa-chevron-down"></i>')}),t("#bd-qf-tags-toggle").on("click",function(){const e=t(this).closest(".bd-qf-tags-row");e.toggleClass("expanded");const s=t("#bd-qf-tags-more");if(e.hasClass("expanded"))s.text("Show Less");else{const e=t(".bd-qf-tag-btn.bd-qf-tag-hidden:not(.bd-qf-tag-category-hidden)").length;s.text("+"+e+" more")}}),t("#bd-qf-tags-more").on("click",function(){const e=t(this).closest(".bd-qf-tags-row");if(e.toggleClass("expanded"),e.hasClass("expanded"))t(this).text("Show Less");else{const e=t(".bd-qf-tag-btn.bd-qf-tag-hidden:not(.bd-qf-tag-category-hidden)").length;t(this).text("+"+e+" more")}}),t("#bd-qf-search").on("input",function(){const s=t(this).val();clearTimeout(e.searchTimer),e.searchTimer=setTimeout(function(){e.state.search=s,e.state.page=1,e.loadBusinesses()},300)}),t("#bd-qf-area").on("change",function(){const s=t(this).val();e.state.area=s?parseInt(s,10):null,e.state.page=1,e.loadBusinesses(),e.updateActiveFilters()}),t("#bd-qf-sort").on("change",function(){e.state.sort=t(this).val(),e.state.page=1,e.loadBusinesses()});var s=window.innerWidth>=1024;let a;function i(){t("#bd-qf-filters-modal").removeClass("bd-qf-modal-visible"),t("body").removeClass("bd-qf-modal-open"),setTimeout(function(){t("#bd-qf-filters-modal").hasClass("bd-qf-modal-visible")||t("#bd-qf-filters-modal").attr("style","display: none;")},200)}s?(e.state.view="split",t(".bd-qf-view-btn").removeClass("active"),t('.bd-qf-view-btn[data-view="split"]').addClass("active")):(e.state.view="list",t(".bd-qf-view-btn").removeClass("active"),t('.bd-qf-view-btn[data-view="list"]').addClass("active"),t("#bd-qf-main-content").addClass("bd-qf-no-split")),t(window).on("resize",function(){clearTimeout(a),a=setTimeout(function(){!function(){const a=window.innerWidth>=1024,i=t("#bd-qf-main-content");a&&!s?(e.state.view="split",i.removeClass("bd-qf-no-split")):!a&&s&&("split"===e.state.view&&(e.state.view="list"),i.addClass("bd-qf-no-split")),t(".bd-qf-view-btn").removeClass("active"),t('.bd-qf-view-btn[data-view="'+e.state.view+'"]').addClass("active"),s=a,setTimeout(function(){e.map&&e.map.invalidateSize()},100)}(),e.map&&e.map.invalidateSize()},250)}),t(".bd-qf-view-btn").on("click",function(){const s=t(this).data("view");t(".bd-qf-view-btn").removeClass("active"),t(this).addClass("active"),e.state.view=s;const a=t("#bd-qf-main-content");"split"===s?a.removeClass("bd-qf-no-split"):a.addClass("bd-qf-no-split"),setTimeout(function(){e.map&&e.map.invalidateSize()},100),e.renderView()}),t(document).on("mouseenter",".bd-qf-card",function(){const s=t(this).data("business-id");e.markers.forEach(function(a){a.businessId===s&&("split"===e.state.view&&e.map&&e.map.panTo(a.getLatLng(),{animate:!0}),a._icon&&t(a._icon).addClass("bd-marker-highlight"))})}),t(document).on("mouseleave",".bd-qf-card",function(){e.markers.forEach(function(e){e._icon&&t(e._icon).removeClass("bd-marker-highlight")})}),t("#bd-qf-more-filters").on("click",function(){t("#bd-qf-filters-modal").attr("style","").addClass("bd-qf-modal-visible"),t("body").addClass("bd-qf-modal-open")}),t(".bd-qf-filters-modal-close").on("click",i),t("#bd-qf-filters-modal").on("click",function(e){t(e.target).is("#bd-qf-filters-modal")&&i()}),t(document).on("keydown",function(e){"Escape"===e.key&&t("#bd-qf-filters-modal").hasClass("bd-qf-modal-visible")&&i()}),t(document).on("click",".bd-qf-price-btn",function(){t(this).toggleClass("active")}),t(document).on("click",".bd-qf-rating-btn",function(){t(".bd-qf-rating-btn").removeClass("active"),t(this).addClass("active")}),t(".bd-qf-filters-apply").on("click",function(){e.state.priceLevel=[],t(".bd-qf-price-btn.active").each(function(){e.state.priceLevel.push(t(this).data("price"))});const s=t(".bd-qf-rating-btn.active");e.state.minRating=s.length?parseInt(s.data("rating"),10):null,e.state.openNow=t("#bd-qf-open-now").is(":checked");const a=e.state.priceLevel.length>0||e.state.minRating||e.state.openNow;t("#bd-qf-more-filters").toggleClass("has-filters",a),e.state.page=1,e.loadBusinesses(),e.updateActiveFilters(),t("#bd-qf-filters-modal").removeClass("bd-qf-modal-visible"),t("body").removeClass("bd-qf-modal-open"),setTimeout(function(){t("#bd-qf-filters-modal").hasClass("bd-qf-modal-visible")||t("#bd-qf-filters-modal").attr("style","display: none;")},200)}),t(".bd-qf-filters-clear").on("click",function(){t(".bd-qf-price-btn").removeClass("active"),t(".bd-qf-rating-btn").removeClass("active"),t("#bd-qf-open-now").prop("checked",!1)}),t("#bd-qf-clear-all").on("click",function(){e.clearAllFilters()}),t(document).on("click",".bd-qf-pill-close, .bd-qf-active-pill button",function(s){s.stopPropagation();const a=t(this).closest(".bd-qf-active-pill"),i=a.data("filter-type"),n=a.data("filter-value");e.removeFilter(i,n)}),t(document).on("click",".bd-qf-card .bd-save-btn",function(s){s.preventDefault(),s.stopPropagation();const a=t(this).closest(".bd-save-wrapper").data("business-id");if(!(t("body").hasClass("logged-in")||t("#wpadminbar").length>0))return e.showToast("Please log in to save to a list"),void setTimeout(function(){window.location.href="/wp-login.php?redirect_to="+encodeURIComponent(window.location.href)},1500);let i=t("#bd-qf-save-modal");if(!i.length){const e='\n\t\t\t\t\t\t<div id="bd-qf-save-modal" class="bd-qf-save-modal" style="display:none;">\n\t\t\t\t\t\t\t<div class="bd-qf-save-modal-content">\n\t\t\t\t\t\t\t\t<div class="bd-qf-save-modal-header">\n\t\t\t\t\t\t\t\t\t<h4>Save to List</h4>\n\t\t\t\t\t\t\t\t\t<button type="button" class="bd-qf-save-modal-close"><i class="fas fa-times"></i></button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="bd-qf-save-modal-body">\n\t\t\t\t\t\t\t\t\t<div class="bd-qf-save-loading">\n\t\t\t\t\t\t\t\t\t\t<i class="fas fa-spinner fa-spin"></i> Loading your lists...\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="bd-qf-save-lists"></div>\n\t\t\t\t\t\t\t\t\t<div class="bd-qf-save-create">\n\t\t\t\t\t\t\t\t\t\t<input type="text" class="bd-qf-save-new-list" placeholder="Create new list...">\n\t\t\t\t\t\t\t\t\t\t<button type="button" class="bd-qf-save-create-btn">Create</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t';t("body").append(e),i=t("#bd-qf-save-modal")}i.data("business-id",a),i.fadeIn(200),t("body").addClass("bd-qf-modal-open");const n=i.find(".bd-qf-save-lists"),o=i.find(".bd-qf-save-loading");o.show(),n.empty(),t.ajax({url:bdQuickFilters.restUrl+"lists",method:"GET",headers:{"X-WP-Nonce":bdQuickFilters.nonce},success:function(t){o.hide();var e=[];if(t&&t.lists&&Array.isArray(t.lists)?e=t.lists:Array.isArray(t)&&(e=t),e.length>0)for(var s=0;s<e.length;s++){var a=e[s],i='<label class="bd-qf-save-list-item"><input type="checkbox" data-list-id="'+a.id+'"><span class="bd-qf-save-list-title">'+(a.title||"Untitled")+'</span><span class="bd-qf-save-list-count">'+(a.item_count||0)+" items</span></label>";n.append(i)}else n.html('<p class="bd-qf-save-empty">No lists yet. Create one below!</p>')},error:function(t){o.hide(),console.error("Lists API error:",t.status,t.responseText),n.html('<p class="bd-qf-save-error">Could not load lists. Please try again.</p>')}})}),t(document).on("click",".bd-qf-save-modal-close",function(){t("#bd-qf-save-modal").fadeOut(200),t("body").removeClass("bd-qf-modal-open")}),t(document).on("click","#bd-qf-save-modal",function(e){t(e.target).is("#bd-qf-save-modal")&&(t(this).fadeOut(200),t("body").removeClass("bd-qf-modal-open"))}),t(document).on("change",'.bd-qf-save-list-item input[type="checkbox"]',function(){const s=t(this),a=s.closest(".bd-qf-save-list-item"),i=s.closest(".bd-qf-save-modal").data("business-id"),n=s.data("list-id"),o=s.is(":checked");a.toggleClass("bd-in-list",o);const r={url:o?bdQuickFilters.restUrl+"lists/"+n+"/items":bdQuickFilters.restUrl+"lists/"+n+"/items/"+i,method:o?"POST":"DELETE",headers:{"X-WP-Nonce":bdQuickFilters.nonce},success:function(){e.showToast(o?"Added to list!":"Removed from list"),e.updateHeartIcon(i)},error:function(){e.showToast("Error updating list","error"),s.prop("checked",!o),a.toggleClass("bd-in-list",!o)}};o&&(r.data={business_id:i}),t.ajax(r)}),t(document).on("click",".bd-qf-save-create-btn",function(){const s=t(this).closest(".bd-qf-save-modal"),a=s.find(".bd-qf-save-new-list"),i=a.val().trim(),n=s.data("business-id");if(!i)return void a.focus();const o=t(this);o.prop("disabled",!0).text("Creating..."),t.ajax({url:bdQuickFilters.restUrl+"lists/quick-save",method:"POST",headers:{"X-WP-Nonce":bdQuickFilters.nonce},data:{business_id:n,new_list:i},success:function(t){a.val("");const i=s.find(".bd-qf-save-lists");i.find(".bd-qf-save-empty").remove();const o=t.list||t;i.append(`\n\t\t\t\t\t\t\t<label class="bd-qf-save-list-item bd-in-list">\n\t\t\t\t\t\t\t\t<input type="checkbox" data-list-id="${o.id}" checked>\n\t\t\t\t\t\t\t\t<span class="bd-qf-save-list-title">${e.escapeHtml(o.title)}</span>\n\t\t\t\t\t\t\t\t<span class="bd-qf-save-list-count">1 items</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t`),e.updateHeartIcon(n),e.showToast("List created and saved!")},error:function(t){e.showToast(t.responseJSON?.message||"Error creating list","error")},complete:function(){o.prop("disabled",!1).text("Create")}})})},showToast:function(e){t(".bd-qf-toast").remove();const s=t('<div class="bd-qf-toast">'+this.escapeHtml(e)+"</div>");t("body").append(s),setTimeout(function(){s.addClass("show")},10),setTimeout(function(){s.removeClass("show"),setTimeout(function(){s.remove()},300)},2500)},initMap:function(){const e=this;if(!t("#bd-qf-map").length||"undefined"==typeof L)return;this.map=L.map("bd-qf-map").setView([37.6819,-121.768],11),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(this.map),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){e.state.lat=t.coords.latitude,e.state.lng=t.coords.longitude,e.map.setView([e.state.lat,e.state.lng],12),e.loadBusinesses()},function(){})},updateMapMarkers:function(e){const s=this;if(!this.map)return;if(this.markerCluster&&this.map.removeLayer(this.markerCluster),this.markers.forEach(function(t){s.map.removeLayer(t)}),this.markers=[],!e||!e.length)return;const a=[],i="function"==typeof L.markerClusterGroup;if(i&&(this.markerCluster=L.markerClusterGroup({iconCreateFunction:function(t){const e=t.getChildCount();let s="small";return e>10&&(s="medium"),e>25&&(s="large"),L.divIcon({html:'<div class="bd-cluster bd-cluster-'+s+'"><span>'+e+"</span></div>",className:"bd-cluster-icon",iconSize:["small"===s?36:"medium"===s?44:52,"small"===s?36:"medium"===s?44:52]})},maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1})),e.forEach(function(e){const n=e.location;if(n&&n.lat&&n.lng){const o=L.divIcon({className:"bd-heart-icon",html:'<div class="bd-heart-marker"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>',iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),r=L.marker([n.lat,n.lng],{icon:o}).bindPopup(s.createPopupContent(e),{maxWidth:250,minWidth:200,className:"bd-qf-map-popup"});r.businessId=e.id,r.on("mouseover",function(){t('.bd-qf-card[data-business-id="'+e.id+'"]').addClass("bd-qf-card-highlight")}),r.on("mouseout",function(){t('.bd-qf-card[data-business-id="'+e.id+'"]').removeClass("bd-qf-card-highlight")}),i?s.markerCluster.addLayer(r):r.addTo(s.map),s.markers.push(r),a.push([n.lat,n.lng])}}),i&&this.markerCluster&&this.map.addLayer(this.markerCluster),a.length>0)try{s.map.fitBounds(a,{padding:[50,50],maxZoom:14})}catch(t){}},createPopupContent:function(t){let e='<div class="bd-qf-popup" style="min-width:180px;padding:8px 4px;">';return e+='<div style="font-weight:700;font-size:14px;margin-bottom:6px;line-height:1.3;">'+this.escapeHtml(this.decodeHtml(t.title))+"</div>",t.rating>0&&(e+='<div style="font-size:13px;color:#666;margin-bottom:8px;">'+t.rating+" ★ ("+(t.review_count||0)+" reviews)</div>"),t.location&&t.location.city&&(e+='<div style="font-size:12px;color:#888;margin-bottom:8px;"><i class="fas fa-map-marker-alt" style="color:#2CB1BC;margin-right:4px;"></i>'+this.escapeHtml(t.location.city)+"</div>"),e+='<a href="'+this.escapeHtml(t.permalink)+'" style="display:inline-block;padding:8px 16px;background:#1a3a4a;color:#fff;border-radius:6px;font-size:13px;font-weight:600;text-decoration:none;">View Details</a>',e+="</div>",e},loadBusinesses:function(){const e=this,s=t("#bd-qf-businesses");s.html('<p class="bd-qf-loading"><i class="fas fa-spinner fa-spin"></i> Loading...</p>');const a={per_page:20,page:this.state.page};this.state.category&&(a.categories=this.state.category),this.state.area&&(a.areas=this.state.area),this.state.tags.length>0&&(a.tags=this.state.tags.join(",")),this.state.priceLevel.length>0&&(a.price_level=this.state.priceLevel.join(",")),this.state.minRating&&(a.min_rating=this.state.minRating),this.state.openNow&&(a.open_now=1),this.state.search&&(a.q=this.state.search),this.state.lat&&this.state.lng&&(a.lat=this.state.lat,a.lng=this.state.lng),"featured"===this.state.sort?a.sort="name":a.sort=this.state.sort,t.ajax({url:bdQuickFilters.restUrl+"businesses",method:"GET",data:a,beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",bdQuickFilters.nonce)},success:function(t){let s=t.businesses||t||[];"featured"===e.state.sort&&e.data.featuredIds&&e.data.featuredIds.length>0&&(s=e.sortFeaturedFirst(s)),e.currentBusinesses=s,e.renderBusinesses(s),e.updateResultsCount(t.total||s.length),e.updateMapMarkers(s),e.updateUrl()},error:function(t,e,a){console.error("Failed to load businesses:",a),s.html('<div class="bd-qf-no-results"><i class="fas fa-exclamation-circle"></i><p>Failed to load businesses. Please try again.</p></div>')}})},sortFeaturedFirst:function(t){const e=this.data.featuredIds||[];if(!e.length)return t;const s=[],a=[];return t.forEach(function(t){const i=e.indexOf(t.id);-1!==i?(t._featuredIndex=i,s.push(t)):a.push(t)}),s.sort(function(t,e){return t._featuredIndex-e._featuredIndex}),s.concat(a)},renderBusinesses:function(e){const s=t("#bd-qf-businesses");e&&0!==e.length?(this.currentBusinesses=e,this.renderView()):s.html('<div class="bd-qf-no-results"><i class="fas fa-search"></i><p>'+bdQuickFilters.strings.noResults+"</p></div>")},renderView:function(){const e=t("#bd-qf-businesses"),s=this.currentBusinesses||[];if(!s.length)return;e.removeClass("bd-qf-view-grid bd-qf-view-list bd-qf-view-split"),"split"===this.state.view?e.addClass("bd-qf-view-split"):e.addClass("bd-qf-view-"+this.state.view);let a="";const i=this;s.forEach(function(t){a+=i.renderCard(t)}),e.html(a),"undefined"!=typeof bdLists&&("function"==typeof bdLists.reinit?bdLists.reinit():"function"==typeof bdLists.init&&bdLists.init()),t(document).trigger("bd:cards-rendered")},renderCard:function(t){const e=this,s=(t.tags||[]).slice(0,3).map(function(t){return'<span class="bd-qf-card-tag">'+e.escapeHtml(e.decodeHtml(t.name))+"</span>"}).join("");let a='<article class="bd-qf-card'+(this.data.featuredIds&&-1!==this.data.featuredIds.indexOf(t.id)?" bd-qf-featured":"")+'" data-business-id="'+t.id+'">';if(a+='<div class="bd-qf-card-image"',t.featured_image?(a+=">",a+='<img src="'+this.escapeHtml(t.featured_image)+'" alt="'+this.escapeHtml(this.decodeHtml(t.title))+'" loading="lazy">'):(a+=' style="background: linear-gradient(135deg, #0f2a43 0%, #0a1f33 100%);">',a+=this.renderPlaceholderSVG(t)),t.distance&&t.distance.display&&(a+='<span class="bd-qf-card-distance">'+this.escapeHtml(t.distance.display)+"</span>"),a+='<div class="bd-qf-card-save">',a+=this.renderSaveButton(t.id),a+="</div>",a+="</div>",a+='<div class="bd-qf-card-content">',a+='<h3 class="bd-qf-card-title">',a+='<a href="'+this.escapeHtml(t.permalink)+'">'+this.escapeHtml(this.decodeHtml(t.title))+"</a>",a+="</h3>",a+='<div class="bd-qf-card-rating">',t.rating>0?(a+='<div class="bd-qf-card-stars">'+this.renderStars(t.rating)+"</div>",a+='<span class="bd-qf-card-rating-value">'+t.rating+"</span>",a+='<span class="bd-qf-card-review-count">('+(t.review_count||0)+")</span>"):a+='<span class="bd-qf-card-no-reviews">No reviews yet</span>',a+="</div>",t.categories&&t.categories.length>0&&(a+='<span class="bd-qf-card-category">'+this.escapeHtml(this.decodeHtml(t.categories[0]))+"</span>"),t.areas&&t.areas.length>0&&(a+='<div class="bd-qf-card-location">',a+='<i class="fas fa-map-marker-alt"></i> ',a+=this.escapeHtml(this.decodeHtml(t.areas[0])),a+="</div>"),t.excerpt){const e=t.excerpt.replace(/<[^>]*>/g,"").substring(0,150);a+='<p class="bd-qf-card-excerpt">'+this.escapeHtml(this.decodeHtml(e)),t.excerpt.length>150&&(a+="..."),a+="</p>"}return s&&(a+='<div class="bd-qf-card-tags">'+s+"</div>"),a+="</div>",a+='<a href="'+this.escapeHtml(t.permalink)+'" class="bd-qf-card-cta">',a+='View Details <i class="fas fa-arrow-right"></i>',a+="</a>",a+="</article>",a},updateHeartIcon:function(e){const s=t('.bd-save-wrapper[data-business-id="'+e+'"]'),a=t("#bd-qf-save-modal .bd-qf-save-list-item.bd-in-list").length>0;s.find(".bd-save-btn i").toggleClass("far",!a).toggleClass("fas",a)},renderSaveButton:function(t){let e='<div class="bd-save-wrapper" data-business-id="'+t+'">';return e+='<button type="button" class="bd-save-btn" title="Save to List">',e+='<i class="far fa-heart"></i>',e+="</button>",e+="</div>",e},renderPlaceholderSVG:function(t){var e=t.location||{},s=parseFloat(e.lat)||0,a=parseFloat(e.lng)||0,i="";0===s&&0===a||(i=Math.abs(s).toFixed(2)+"N "+Math.abs(a).toFixed(2)+"W");var n='<div class="bd-qf-card-placeholder" aria-hidden="true">';return n+='<svg viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">',n+='<ellipse cx="200" cy="100" rx="180" ry="90" fill="none" stroke="rgba(201,162,39,0.08)" stroke-width="1"/>',n+='<ellipse cx="200" cy="100" rx="150" ry="75" fill="none" stroke="rgba(201,162,39,0.10)" stroke-width="1"/>',n+='<ellipse cx="200" cy="100" rx="120" ry="60" fill="none" stroke="rgba(201,162,39,0.13)" stroke-width="1"/>',n+='<ellipse cx="200" cy="100" rx="90" ry="45" fill="none" stroke="rgba(201,162,39,0.16)" stroke-width="1"/>',n+='<ellipse cx="200" cy="100" rx="65" ry="33" fill="none" stroke="rgba(201,162,39,0.20)" stroke-width="1.5"/>',n+='<ellipse cx="200" cy="100" rx="40" ry="20" fill="none" stroke="rgba(201,162,39,0.25)" stroke-width="1.5"/>',n+='<ellipse cx="195" cy="105" rx="160" ry="80" fill="none" stroke="rgba(168,196,212,0.06)" stroke-width="0.8"/>',n+='<ellipse cx="205" cy="95" rx="130" ry="65" fill="none" stroke="rgba(168,196,212,0.08)" stroke-width="0.8"/>',n+='<ellipse cx="198" cy="102" rx="100" ry="50" fill="none" stroke="rgba(168,196,212,0.10)" stroke-width="0.8"/>',n+='<circle cx="200" cy="90" r="22" fill="rgba(44,177,188,0.12)"/>',n+='<g transform="translate(188,74)" fill="rgba(255,255,255,0.7)">',n+='<path d="M12 0C8.13 0 5 3.13 5 7c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>',n+="</g>",i&&(n+='<text x="200" y="185" text-anchor="middle" fill="rgba(168,196,212,0.35)" font-family="Inter,system-ui,sans-serif" font-size="11" letter-spacing="1.5">'+this.escapeHtml(i)+"</text>"),n+="</svg></div>"},renderStars:function(t){let e="";const s=Math.floor(t),a=t-s>=.5;for(let t=1;t<=5;t++)if(t<=s)e+='<svg width="14" height="14" viewBox="0 0 24 24" fill="#2CB1BC"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';else if(t===s+1&&a){const t="half-"+Math.random().toString(36).substr(2,9);e+='<svg width="14" height="14" viewBox="0 0 24 24"><defs><linearGradient id="'+t+'"><stop offset="50%" stop-color="#2CB1BC"/><stop offset="50%" stop-color="#d1d5db"/></linearGradient></defs><path fill="url(#'+t+')" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>'}else e+='<svg width="14" height="14" viewBox="0 0 24 24" fill="#d1d5db"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';return e},updateResultsCount:function(e){const s=1===e?bdQuickFilters.strings.resultCount:bdQuickFilters.strings.resultsCount.replace("%d",e);t("#bd-qf-results-count").text(s)},updateActiveFilters:function(){const e=t("#bd-qf-active-filters"),s=t("#bd-qf-clear-all");let a="",i=0;if(this.state.category){const t=this.data.categories.find(function(t){return t.id===this.state.category}.bind(this));t&&(a+=this.renderFilterPill("category",this.state.category,t.name),i++)}if(this.state.area){const t=this.data.areas.find(function(t){return t.id===this.state.area}.bind(this));t&&(a+=this.renderFilterPill("area",this.state.area,t.name),i++)}this.state.tags.forEach(function(t){const e=this.data.tags.find(function(e){return e.id===t});e&&(a+=this.renderFilterPill("tag",t,e.name),i++)}.bind(this)),this.state.priceLevel.forEach(function(t){a+=this.renderFilterPill("price",t,t),i++}.bind(this)),this.state.minRating&&(a+=this.renderFilterPill("rating",this.state.minRating,this.state.minRating+"+ Stars"),i++),this.state.openNow&&(a+=this.renderFilterPill("openNow",!0,"Open Now"),i++),e.html(a),i>0?s.show().find(".bd-qf-filter-count").text(i):s.hide()},renderFilterPill:function(t,e,s){const a=document.createElement("textarea");a.innerHTML=s;const i=a.value;return'<span class="bd-qf-active-pill" data-filter-type="'+t+'" data-filter-value="'+e+'"><span class="bd-qf-pill-label">'+this.escapeHtml(i)+'</span><button type="button" class="bd-qf-pill-close"><i class="fas fa-times"></i></button></span>'},removeFilter:function(e,s){switch(e){case"category":this.state.category=null,t(".bd-qf-experience-btn").removeClass("active"),this.showAllTags();break;case"area":this.state.area=null,t("#bd-qf-area").val("");break;case"tag":this.state.tags=this.state.tags.filter(function(t){return t!==parseInt(s,10)}),t('.bd-qf-tag-btn[data-tag-id="'+s+'"]').removeClass("active");break;case"price":this.state.priceLevel=this.state.priceLevel.filter(function(t){return t!==s}),t('.bd-qf-price-btn[data-price="'+s+'"]').removeClass("active");break;case"rating":this.state.minRating=null,t(".bd-qf-rating-btn").removeClass("active");break;case"openNow":this.state.openNow=!1,t("#bd-qf-open-now").prop("checked",!1)}const a=this.state.priceLevel.length>0||this.state.minRating||this.state.openNow;t("#bd-qf-more-filters").toggleClass("has-filters",a),this.state.page=1,this.loadBusinesses(),this.updateActiveFilters()},clearAllFilters:function(){this.state.category=null,this.state.area=null,this.state.tags=[],this.state.priceLevel=[],this.state.minRating=null,this.state.openNow=!1,this.state.search="",this.state.page=1,t(".bd-qf-experience-btn").removeClass("active"),t(".bd-qf-tag-btn").removeClass("active"),t(".bd-qf-price-btn").removeClass("active"),t(".bd-qf-rating-btn").removeClass("active"),t("#bd-qf-area").val(""),t("#bd-qf-search").val(""),t("#bd-qf-open-now").prop("checked",!1),t("#bd-qf-more-filters").removeClass("has-filters"),this.showAllTags(),this.loadBusinesses(),this.updateActiveFilters()},filterTagsForCategory:function(e){const s=this,a=t("#bd-qf-tags-list"),i=t(".bd-qf-tags-row");this.tagFilterRequest&&4!==this.tagFilterRequest.readyState&&this.tagFilterRequest.abort(),i.addClass("bd-qf-tags-loading"),this.tagFilterRequest=t.ajax({url:bdQuickFilters.ajaxUrl,method:"POST",data:{action:"bd_get_category_tags",category_id:e,nonce:bdQuickFilters.nonce},success:function(e){if(i.removeClass("bd-qf-tags-loading"),e.success&&e.data.tags){const i=e.data.tags.map(function(t){return t.id}),n=new Set(i),o=a.find(".bd-qf-tag-btn");let r=0;const d=[],l=o.map(function(){const e=t(this),s=parseInt(e.data("tag-id"),10),a=n.has(s),o=e.hasClass("active");return!a&&o&&d.push(s),a&&r++,{element:this,$btn:e,tagId:s,isInCategory:a,sortIndex:a?i.indexOf(s):999999}}).get();l.forEach(function(t){t.isInCategory?t.$btn.removeClass("bd-qf-tag-category-hidden"):t.$btn.addClass("bd-qf-tag-category-hidden").removeClass("active")}),d.length>0&&(s.state.tags=s.state.tags.filter(function(t){return-1===d.indexOf(t)}));const c=l.filter(function(t){return t.isInCategory}).sort(function(t,e){return t.sortIndex-e.sortIndex}),f=document.createDocumentFragment();c.forEach(function(t){f.appendChild(t.element)}),a[0].appendChild(f),s.updateTagsMoreButton(),s.updateNoTagsMessage(0===r)}},error:function(t,e){"abort"!==e&&(i.removeClass("bd-qf-tags-loading"),console.error("Failed to fetch category tags"))}})},showAllTags:function(){const e=t("#bd-qf-tags-list");this.tagFilterRequest&&4!==this.tagFilterRequest.readyState&&this.tagFilterRequest.abort(),t(".bd-qf-tags-row").removeClass("bd-qf-tags-loading"),e.find(".bd-qf-tag-btn").removeClass("bd-qf-tag-category-hidden"),this.updateNoTagsMessage(!1),this.updateTagsMoreButton()},updateTagsMoreButton:function(){const e=t("#bd-qf-tags-list"),s=t("#bd-qf-tags-more"),a=t(".bd-qf-tags-row"),i=e.find(".bd-qf-tag-btn").not(".bd-qf-tag-category-hidden");let n=0;i.each(function(e){const s=t(this);e>=8?(s.addClass("bd-qf-tag-hidden"),n++):s.removeClass("bd-qf-tag-hidden")}),n>0?s.show().text("+"+n+" more"):s.hide(),a.hasClass("expanded")&&(i.removeClass("bd-qf-tag-hidden"),s.text("Show Less"))},updateNoTagsMessage:function(e){const s=t("#bd-qf-tags-list"),a=s.find(".bd-qf-no-tags-message");e?a.length||s.append('<span class="bd-qf-no-tags-message"><i class="fas fa-info-circle"></i> No tags for this category</span>'):a.remove()},decodeHtml:function(t){if(!t)return"";const e=document.createElement("textarea");return e.innerHTML=t,e.value},escapeHtml:function(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}};t(document).ready(function(){t(".bd-qf-wrapper").length&&e.init()})}(jQuery);